<!-- <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Xác Thực KYC - Camera</title>
  <style>
    body {
        font-family: sans-serif;
        padding: 20px;
        text-align: center;
    }

    video, canvas {
        width: 100%;
        max-width: 400px;
        margin-top: 20px;
        border-radius: 12px;
        background: black;
        transform: scaleX(-1); /* Lật ngang video như gương */

    }

    button {
        padding: 10px 20px;
        margin-top: 20px;
        font-size: 16px;
        cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>Xác thực KYC</h2>
  <button id="startCamera">Bật camera</button>
  <br />
  <video id="video" autoplay muted playsinline></video>
  <br />
  <button id="captureBtn" disabled>Chụp ảnh</button>
  <canvas id="canvas" style="display: none;"></canvas>

  <script>
    const video = document.getElementById('video');
    const startBtn = document.getElementById('startCamera');
    const captureBtn = document.getElementById('captureBtn');
    const canvas = document.getElementById('canvas');

    startBtn.addEventListener('click', async () => {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;

        await video.play(); // Trình duyệt yêu cầu play() phải trong tương tác người dùng
        captureBtn.disabled = false;
        console.log("Camera đã bật");
      } catch (err) {
        alert('Không thể truy cập camera: ' + err.message);
        console.error(err);
      }
    });

    captureBtn.addEventListener('click', () => {
      const ctx = canvas.getContext('2d');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

      const imageData = canvas.toDataURL('image/png');
      console.log("Ảnh chụp:", imageData);

      // TODO: Gửi imageData lên server để xử lý KYC
      alert("Đã chụp ảnh (xem console log)");
    });
  </script>
</body>
</html> -->


<style>
body {
    font-family: sans-serif;
    text-align: center;
    padding: 20px;
}

video, canvas {
    width: 100%;
    max-width: 400px;
    border-radius: 12px;
    margin-top: 20px;
    background: black;
    transform: scaleX(-1); /* Xoay gương */
}

button {
    padding: 10px 20px;
    margin: 10px 5px;
    font-size: 16px;
    cursor: pointer;
}
</style>

<button id="startCamera">Bật camera</button>
<button id="startRecord" disabled>Bắt đầu quay</button>
<button id="stopRecord" disabled>Dừng quay</button>
<br />
<video id="video" autoplay muted playsinline></video>
<br />
<a id="downloadLink" style="display:none;" download="kyc-record.mp4">Tải video về</a>

<script>
        const video = document.getElementById('video');
        const startCameraBtn = document.getElementById('startCamera');
        const startRecordBtn = document.getElementById('startRecord');
        const stopRecordBtn = document.getElementById('stopRecord');
        const downloadLink = document.getElementById('downloadLink');

        let stream;
        let mediaRecorder;
        let recordedChunks = [];

        startCameraBtn.addEventListener('click', async () => {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
                video.srcObject = stream;
                await video.play();

                startRecordBtn.disabled = false;
                console.log("Camera đã bật");
            } catch (err) {
                alert("Không thể truy cập camera: " + err.message);
                console.error(err);
            }
        });

        startRecordBtn.addEventListener('click', () => {
            if (!stream) return;

            recordedChunks = [];
            mediaRecorder = new MediaRecorder(stream);

            mediaRecorder.ondataavailable = (e) => {
                if (e.data.size > 0) recordedChunks.push(e.data);
            };

            mediaRecorder.onstop = () => {
                const blob = new Blob(recordedChunks, { type: 'video/mp4' });
                const url = URL.createObjectURL(blob);

                downloadLink.href = url;
                downloadLink.style.display = 'inline';
                downloadLink.textContent = "Tải video về";

                console.log("Video blob:", blob);
            };

            mediaRecorder.start();
            console.log("Bắt đầu quay");

            startRecordBtn.disabled = true;
            stopRecordBtn.disabled = false;
            downloadLink.style.display = 'none';
        });

        stopRecordBtn.addEventListener('click', () => {
        if (mediaRecorder && mediaRecorder.state !== "inactive") {
            mediaRecorder.stop();
            console.log("Dừng quay");
            startRecordBtn.disabled = false;
            stopRecordBtn.disabled = true;
        }
    });
</script>

